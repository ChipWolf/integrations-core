version: '3'
# Adapted from https://github.com/JetBrains/teamcity-docker-samples
services:
  teamcity-server:
    container_name: teamcity-server
    image: jetbrains/teamcity-server:latest
    ports:
      - "8111:8111"
    volumes:
      - ./teamcity_backup.zip:/teamcity_backup.zip

  teamcity-agent:
    container_name: teamcity-agent
    build:
      context: .
      dockerfile: Dockerfile-agent
    environment:
      - AGENT_NAME=regular_agent
      - SERVER_URL=http://teamcity-server:8111
      - AGENT_TOKEN=56ac4711fbd5355d2b10ed5be8f932f6
    volumes:
      - ./test_sample.py:/test_sample.py

  teamcity-minimal-agent:
    container_name: teamcity-minimal-agent
    build:
      context: .
      dockerfile: Dockerfile-minimal_agent
    environment:
      - AGENT_NAME=minimal_agent
      - SERVER_URL=http://teamcity-server:8111
      - AGENT_TOKEN=07f3ff35094bc13a45865f5abc8699bb
    volumes:
      - ./test_sample.py:/test_sample.py
